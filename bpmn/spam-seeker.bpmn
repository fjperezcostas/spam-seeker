<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_192ncdl" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.28.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.7.0">
  <bpmn:process id="spam-seeker" name="spam-seeker" isExecutable="true">
    <bpmn:exclusiveGateway id="Gateway_1kuywrj" name="is spam?" default="Flow_1fstakj">
      <bpmn:incoming>Flow_1wr0mob</bpmn:incoming>
      <bpmn:outgoing>Flow_1fstakj</bpmn:outgoing>
      <bpmn:outgoing>Flow_1bf67qs</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1wr0mob" sourceRef="Activity_18fp9y1" targetRef="Gateway_1kuywrj" />
    <bpmn:endEvent id="Event_03rfdr3" name="no-spam">
      <bpmn:incoming>Flow_1fstakj</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1fstakj" name="no" sourceRef="Gateway_1kuywrj" targetRef="Event_03rfdr3" />
    <bpmn:serviceTask id="Activity_18fp9y1" name="check spam">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="check-spam" />
        <zeebe:ioMapping>
          <zeebe:input source="=body" target="email" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0g43y2u</bpmn:incoming>
      <bpmn:outgoing>Flow_1wr0mob</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1bf67qs" name="yes" sourceRef="Gateway_1kuywrj" targetRef="Activity_154ddwa">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=label = "spam"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_154ddwa" name="confirm email removal">
      <bpmn:extensionElements>
        <zeebe:formDefinition formId="confirm-email-removal-form" />
        <zeebe:userTask />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1bf67qs</bpmn:incoming>
      <bpmn:outgoing>Flow_05mg01r</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1p5stwr" name="delete spam?" default="Flow_1senzrj">
      <bpmn:incoming>Flow_05mg01r</bpmn:incoming>
      <bpmn:outgoing>Flow_1senzrj</bpmn:outgoing>
      <bpmn:outgoing>Flow_0o8awd5</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_05mg01r" sourceRef="Activity_154ddwa" targetRef="Gateway_1p5stwr" />
    <bpmn:endEvent id="Event_1pom8og" name="keep spam in inbox">
      <bpmn:incoming>Flow_1senzrj</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1senzrj" name="no" sourceRef="Gateway_1p5stwr" targetRef="Event_1pom8og" />
    <bpmn:endEvent id="Event_06b66ld" name="spam deleted">
      <bpmn:incoming>Flow_0o8awd5</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0o8awd5" name="yes" sourceRef="Gateway_1p5stwr" targetRef="Event_06b66ld">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=remove_email = "true"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:startEvent id="StartEvent_1" name="new email received" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailMessageStart.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
      <bpmn:extensionElements>
        <zeebe:properties>
          <zeebe:property name="inbound.type" value="io.camunda:connector-email-inbound:1" />
          <zeebe:property name="authentication.type" value="simple" />
          <zeebe:property name="authentication.username" value="" />
          <zeebe:property name="authentication.password" value="" />
          <zeebe:property name="data.imapConfig.imapHost" value="imap.gmail.com" />
          <zeebe:property name="data.imapConfig.imapPort" value="993" />
          <zeebe:property name="data.imapConfig.imapCryptographicProtocol" value="TLS" />
          <zeebe:property name="data.pollingWaitTime" value="PT10S" />
          <zeebe:property name="data.pollingConfigDiscriminator" value="unseenPollingConfig" />
          <zeebe:property name="data.pollingConfig.handlingStrategy" value="READ" />
          <zeebe:property name="consumeUnmatchedEvents" value="true" />
          <zeebe:property name="correlationRequired" value="notRequired" />
          <zeebe:property name="deduplicationModeManualFlag" value="false" />
          <zeebe:property name="deduplicationMode" value="AUTO" />
          <zeebe:property name="resultVariable" value="email" />
          <zeebe:property name="resultExpression" value="=message" />
        </zeebe:properties>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_0d012vq</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0slev2p" messageRef="Message_120gjf3" />
    </bpmn:startEvent>
    <bpmn:scriptTask id="Activity_1p9yuxy" name="set email subject">
      <bpmn:extensionElements>
        <zeebe:script expression="=email.subject" resultVariable="subject" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1sxhiwb</bpmn:incoming>
      <bpmn:outgoing>Flow_0ett2id</bpmn:outgoing>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="Flow_0d012vq" sourceRef="StartEvent_1" targetRef="Gateway_01nfinq" />
    <bpmn:parallelGateway id="Gateway_01nfinq">
      <bpmn:incoming>Flow_0d012vq</bpmn:incoming>
      <bpmn:outgoing>Flow_1sxhiwb</bpmn:outgoing>
      <bpmn:outgoing>Flow_1mo54fp</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:sequenceFlow id="Flow_1sxhiwb" sourceRef="Gateway_01nfinq" targetRef="Activity_1p9yuxy" />
    <bpmn:sequenceFlow id="Flow_1mo54fp" sourceRef="Gateway_01nfinq" targetRef="Activity_03z8oij" />
    <bpmn:parallelGateway id="Gateway_1l2qbbp">
      <bpmn:incoming>Flow_0ett2id</bpmn:incoming>
      <bpmn:incoming>Flow_0pq6ohz</bpmn:incoming>
      <bpmn:outgoing>Flow_0g43y2u</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:sequenceFlow id="Flow_0g43y2u" sourceRef="Gateway_1l2qbbp" targetRef="Activity_18fp9y1" />
    <bpmn:sequenceFlow id="Flow_0ett2id" sourceRef="Activity_1p9yuxy" targetRef="Gateway_1l2qbbp" />
    <bpmn:sequenceFlow id="Flow_0pq6ohz" sourceRef="Activity_03z8oij" targetRef="Gateway_1l2qbbp" />
    <bpmn:scriptTask id="Activity_03z8oij" name="set email body">
      <bpmn:extensionElements>
        <zeebe:script expression="=email.plainTextBody" resultVariable="body" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1mo54fp</bpmn:incoming>
      <bpmn:outgoing>Flow_0pq6ohz</bpmn:outgoing>
    </bpmn:scriptTask>
    <bpmn:textAnnotation id="TextAnnotation_091tv91">
      <bpmn:text>email removal not yet implemented, out of the scope of this PoC</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0i9aq5o" associationDirection="None" sourceRef="Event_06b66ld" targetRef="TextAnnotation_091tv91" />
    <bpmn:textAnnotation id="TextAnnotation_1fbojj2">
      <bpmn:text>it uses an AI agent worker to determine if incoming email is spam or not</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_1p7tvhq" associationDirection="None" sourceRef="Activity_18fp9y1" targetRef="TextAnnotation_1fbojj2" />
  </bpmn:process>
  <bpmn:message id="Message_1in0nbv" name="new-email" />
  <bpmn:message id="Message_120gjf3" name="154ee50f-4eda-483d-afcc-20c48d5af891" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailMessageStart.v1" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="spam-seeker">
      <bpmndi:BPMNShape id="Gateway_1kuywrj_di" bpmnElement="Gateway_1kuywrj" isMarkerVisible="true">
        <dc:Bounds x="855" y="202" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="858" y="172" width="45" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_03rfdr3_di" bpmnElement="Event_03rfdr3" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="862" y="342" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="859" y="385" width="43" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_16od4tp_di" bpmnElement="Activity_18fp9y1">
        <dc:Bounds x="680" y="187" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1afdmhk_di" bpmnElement="Activity_154ddwa">
        <dc:Bounds x="970" y="187" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1p5stwr_di" bpmnElement="Gateway_1p5stwr" isMarkerVisible="true">
        <dc:Bounds x="1135" y="202" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1127" y="172" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1pom8og_di" bpmnElement="Event_1pom8og" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <dc:Bounds x="1142" y="342" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1128" y="385" width="66" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_06b66ld_di" bpmnElement="Event_06b66ld" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="1252" y="209" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1237" y="252" width="67" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0g3vmwy_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="142" y="209" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="135" y="245" width="50" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1b4ajtv_di" bpmnElement="Activity_1p9yuxy">
        <dc:Bounds x="360" y="110" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1uglveg_di" bpmnElement="Gateway_01nfinq">
        <dc:Bounds x="255" y="202" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1hqaqq6_di" bpmnElement="Gateway_1l2qbbp">
        <dc:Bounds x="515" y="202" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_04gp8rk_di" bpmnElement="Activity_03z8oij">
        <dc:Bounds x="360" y="280" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_091tv91_di" bpmnElement="TextAnnotation_091tv91">
        <dc:Bounds x="1310" y="80" width="140" height="53" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1fbojj2_di" bpmnElement="TextAnnotation_1fbojj2">
        <dc:Bounds x="760" y="90" width="130" height="70" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1wr0mob_di" bpmnElement="Flow_1wr0mob">
        <di:waypoint x="780" y="227" />
        <di:waypoint x="855" y="227" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1fstakj_di" bpmnElement="Flow_1fstakj">
        <di:waypoint x="880" y="252" />
        <di:waypoint x="880" y="342" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="889" y="294" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1bf67qs_di" bpmnElement="Flow_1bf67qs">
        <di:waypoint x="905" y="227" />
        <di:waypoint x="970" y="227" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="929" y="209" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_05mg01r_di" bpmnElement="Flow_05mg01r">
        <di:waypoint x="1070" y="227" />
        <di:waypoint x="1135" y="227" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1senzrj_di" bpmnElement="Flow_1senzrj">
        <di:waypoint x="1160" y="252" />
        <di:waypoint x="1160" y="342" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1169" y="294" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0o8awd5_di" bpmnElement="Flow_0o8awd5">
        <di:waypoint x="1185" y="227" />
        <di:waypoint x="1252" y="227" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1210" y="209" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d012vq_di" bpmnElement="Flow_0d012vq">
        <di:waypoint x="178" y="227" />
        <di:waypoint x="255" y="227" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1sxhiwb_di" bpmnElement="Flow_1sxhiwb">
        <di:waypoint x="280" y="202" />
        <di:waypoint x="280" y="150" />
        <di:waypoint x="360" y="150" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mo54fp_di" bpmnElement="Flow_1mo54fp">
        <di:waypoint x="280" y="252" />
        <di:waypoint x="280" y="320" />
        <di:waypoint x="360" y="320" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0g43y2u_di" bpmnElement="Flow_0g43y2u">
        <di:waypoint x="565" y="227" />
        <di:waypoint x="680" y="227" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ett2id_di" bpmnElement="Flow_0ett2id">
        <di:waypoint x="460" y="150" />
        <di:waypoint x="540" y="150" />
        <di:waypoint x="540" y="202" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0pq6ohz_di" bpmnElement="Flow_0pq6ohz">
        <di:waypoint x="460" y="320" />
        <di:waypoint x="540" y="320" />
        <di:waypoint x="540" y="252" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0i9aq5o_di" bpmnElement="Association_0i9aq5o">
        <di:waypoint x="1280" y="212" />
        <di:waypoint x="1334" y="133" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1p7tvhq_di" bpmnElement="Association_1p7tvhq">
        <di:waypoint x="756" y="187" />
        <di:waypoint x="774" y="160" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
